<div class="main centered">
    <div class="form-header">
        <mat-icon fontIcon="person" class="title-icon"></mat-icon>
        @if (editMode) {
        <h2>Editar Usuário</h2>
        } @else {
        <h2>Novo Usuário</h2>
        }
        <p>@if (editMode) {Edite as informações do usuário} @else {Crie um novo usuário no sistema}</p>
    </div>

    <form class="edit" [formGroup]="userForm" (ngSubmit)="save()">
        <div class="form-field">
            <mat-form-field appearance="fill">
                <mat-label>Nome Completo</mat-label>
                <input matInput formControlName="name" required placeholder="Digite o nome completo" />
                <mat-icon matPrefix fontIcon="person_outline"></mat-icon>
                @if (userForm.get('name')?.invalid && userForm.get('name')?.touched) {
                <mat-error>Nome é obrigatório</mat-error>
                }
            </mat-form-field>
        </div>

        <div class="form-field">
            <mat-form-field appearance="fill">
                <mat-label>Nome de Usuário</mat-label>
                <input matInput formControlName="username" required placeholder="Digite o nome de usuário" />
                <mat-icon matPrefix fontIcon="badge"></mat-icon>
                @if (userForm.get('username')?.invalid && userForm.get('username')?.touched) {
                @if (userForm.get('username')?.errors?.['required']) {
                <mat-error>Nome de usuário é obrigatório</mat-error>
                }
                @if (userForm.get('username')?.errors?.['minlength']) {
                <mat-error>Mínimo 4 caracteres</mat-error>
                }
                @if (userForm.get('username')?.errors?.['maxlength']) {
                <mat-error>Máximo 15 caracteres</mat-error>
                }
                }
            </mat-form-field>
        </div>

        <div class="form-field">
            <mat-form-field appearance="fill">
                <mat-label>E-mail</mat-label>
                <input matInput formControlName="email" type="email" required placeholder="Digite o e-mail" />
                <mat-icon matPrefix fontIcon="mail_outline"></mat-icon>
                @if (userForm.get('email')?.invalid && userForm.get('email')?.touched) {
                @if (userForm.get('email')?.errors?.['required']) {
                <mat-error>E-mail é obrigatório</mat-error>
                }
                @if (userForm.get('email')?.errors?.['email']) {
                <mat-error>Digite um e-mail válido</mat-error>
                }
                }
            </mat-form-field>
        </div>

        <section class="roles-section">
            <h3>Permissões</h3>
            <p class="section-subtitle">Selecione as permissões do usuário</p>

            <div class="roles-checkboxes">
                <label class="custom-checkbox role-checkbox">
                    <input type="checkbox" [checked]="isRoleSelected('admin')" (change)="toggle('admin')" />
                    <span class="role-badge admin">
                        <mat-icon fontIcon="admin_panel_settings"></mat-icon>
                        <span>Administrador</span>
                    </span>
                </label>

                <label class="custom-checkbox role-checkbox">
                    <input type="checkbox" [checked]="isRoleSelected('project-manager')"
                        (change)="toggle('project-manager')" />
                    <span class="role-badge manager">
                        <mat-icon fontIcon="engineering"></mat-icon>
                        <span>Gerente de Projeto</span>
                    </span>
                </label>

                <label class="custom-checkbox role-checkbox">
                    <input type="checkbox" [checked]="isRoleSelected('user')" (change)="toggle('user')" />
                    <span class="role-badge user">
                        <mat-icon fontIcon="people"></mat-icon>
                        <span>Usuário</span>
                    </span>
                </label>
            </div>

            @if (userForm.get('roles')?.invalid && userForm.get('roles')?.touched) {
            <div class="error">
                <mat-icon fontIcon="error_outline"></mat-icon>
                <span>Selecione pelo menos uma permissão</span>
            </div>
            }
        </section>

        <div class="btn-group">
            <button class="btn btn-outline" type="button" (click)="cancel()">
                <mat-icon fontIcon="close"></mat-icon>
                <span>Cancelar</span>
            </button>
            <button class="btn" type="submit" [disabled]="userForm.invalid">
                <mat-icon fontIcon="save"></mat-icon>
                <span>@if (editMode) {Salvar Alterações} @else {Criar Usuário}</span>
            </button>
        </div>
    </form>
</div>